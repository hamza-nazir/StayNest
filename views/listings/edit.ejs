<% layout('layouts/boilerplate') -%>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4 p-md-5">
          <h2 class="text-center mb-4"><i class="fas fa-edit text-primary me-2"></i>Edit Listing</h2>
          
          <form novalidate id="form" method="post" action="/listings/<%= data._id %>?_method=PUT" enctype="multipart/form-data">
            
            <!-- Title Field -->
            <div class="mb-4">
              <label for="title" class="form-label fw-semibold">Title</label>
              <input required class="form-control py-2" id="title" type="text" name="Listings[title]" value="<%= data.title %>">
              <div class="valid-feedback">Looks good!</div>
              <div class="invalid-feedback">Please provide a title</div>
            </div>
            
            <!-- Description Field -->
            <div class="mb-4">
              <label class="form-label fw-semibold" for="description">Description</label>
              <textarea required id="description" class="form-control py-2" name="Listings[description]" rows="4"><%= data.description %></textarea>
              <div class="valid-feedback">Looks good!</div>
              <div class="invalid-feedback">Please provide a description</div>
            </div>
            
            <!-- Current Image -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Current Image</label>
              <div class="border p-3 rounded-3 text-center">
                <img src="<%= data.image.url %>" class="img-fluid rounded" style="max-height: 200px;" alt="Current listing image">
                <p class="text-muted mt-2 mb-0">Current uploaded image</p>
              </div>
            </div>
            
            <!-- New Image Upload -->
            <div class="mb-4">
              <label class="form-label fw-semibold" for="image">Update Image</label>
              <div class="input-group has-validation">
                <span class="input-group-text"><i class="fas fa-camera"></i></span>
                <input type="file" id="image" class="form-control py-2" name="Listings[image]" accept="image/*">
              </div>
              <div class="form-text">Leave blank to keep current image</div>
            </div>
            
            <!-- Price and Location Row -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label fw-semibold" for="price">Price (â‚¹)</label>
                <input required id="price" class="form-control py-2" type="number" name="Listings[price]" value="<%= data.price %>">
                <div class="valid-feedback">Looks good!</div>
                <div class="invalid-feedback">Please enter a valid price</div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold" for="location">Location</label>
                <input required id="location" class="form-control py-2" type="text" name="Listings[location]" value="<%= data.location %>">
                <div class="valid-feedback">Looks good!</div>
                <div class="invalid-feedback">Please enter a location</div>
              </div>
            </div>
            
            <!-- Country Field -->
            <div class="mb-4">
              <label class="form-label fw-semibold" for="country">Country</label>
              <input required id="country" class="form-control py-2" type="text" name="Listings[country]" value="<%= data.country %>">
              <div class="valid-feedback">Looks good!</div>
              <div class="invalid-feedback">Please enter a country</div>
            </div>
            
            <!-- Submit Button -->
            <div class="d-grid mt-4">
              <button class="btn btn-primary py-2" type="submit">
                <i class="fas fa-save me-2"></i> Update Listing
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .card {
    border-radius: 0.5rem;
  }
  .form-control:focus, .form-select:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.1);
  }
  .btn-primary {
    transition: all 0.3s ease;
  }
  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(13, 110, 253, 0.2);
  }
  .input-group-text {
    background-color: #f8f9fa;
  }
</style>

<script>
// Form validation
(() => {
  'use strict'
  const forms = document.querySelectorAll('.needs-validation')
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      form.classList.add('was-validated')
    }, false)
  })
})()
</script>